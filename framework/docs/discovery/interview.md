# Discovery Interview Log

Generated by DevFramework. Empty on install (2026-01-30 03:40:42 UTC).

## Цели и роли

Q1. Какова основная цель продукта AmazonSender и какую проблему он должен решить для пользователей?
A1. Создать минималистичную утилиту‑исполнитель для разовой или редкой массовой рассылки по существующей базе подписчиков: получить письмо, безопасно и однократно отправить его через Amazon SES и корректно обновить состояние (без функций маркетинговой платформы).

Q2. Кто основные роли/пользователи системы и кто будет запускать рассылки?
A2. Единственный пользователь — человек, который делает рассылку; он же администратор и девелопер.

Q3. Какой ожидаемый результат после рассылки — что считается успешным итогом?
A3. Успех — получение от Amazon SES какого‑то подтверждения/репорта об успешной доставке по всей базе; ожидается, что внешний сервис должен возвращать подтверждение.

Q4. Откуда берётся письмо и как именно вы запускаете рассылку?
A4. Письмо создаётся в Notion с версткой и изображениями; затем нажимается кнопка, которая инициирует сервис через вебхук. Пока неясно, как верстка Notion конвертируется в письмо — предполагается обычный HTML‑шаблон (это нужно проверить).

Q5. Какие поля письма приходят из Notion?
A5. Из Notion приходят только тема и тело письма; имя отправителя, e‑mail и прочие данные хранятся в Supabase. Notion используется как простой редактор HTML‑письма.

Q6. Где хранится база подписчиков и какие статусы там есть?
A6. База подписчиков хранится только в Supabase. Там есть e‑mail и статусы (например, bounced и другие нужные статусы), чтобы корректно работать с Amazon SES и не получить блокировку.

Q7. Какие конкретно статусы подписчиков должны быть поддержаны и что они означают?
A7. В spec_001 указаны статусы subscribers: active | unsubscribed | bounced; события Complaint из SES/SNS приводят к переводу в unsubscribed, Bounce — в bounced. Полный перечень обязательных полей/статусов для compliance с SES пока не определён; нужно уточнить позже или через открытые источники (TODO).

Q8. Каким должен быть формат финального уведомления/отчёта после рассылки?
A8. Стандартный отчёт: количество доставленных писем и/или процент доставки, доля bounce, кто отписался/получил complaint/«забанен», и итоговая доля доставленных в процентах. Ожидается, что это стандартные ответы от Amazon SES.

Q9. Как именно вы хотите получить этот отчёт?
A9. Идеальный вариант — таблица в Notion: запись письма с дополнительными полями, которые после отправки заполняются отчётом через Notion API (Notion используется как база отчётов).

Q10. Какие именно поля отчёта нужны в таблице Notion?
A10. Минимальный набор: дата/время отправки, статус (успешно/нет), количество отправленных, количество доставленных, доли bounce и отписок. Дополнительные поля можно добавить позже.

Q11. Какие правила «стоп‑точек» для рассылки?
A11. Стоп‑точек по bounce нет: bounce происходит после факта отправки, поэтому важно лишь зафиксировать статус адреса (soft/hard bounce) в базе и больше не отправлять туда при следующих рассылках. Ключевое правило — никогда не отправлять повторно адресам со статусом bounced или unsubscribed.

Q12. Какие секреты/ключи используются и где вы хотите их хранить?
A12. Секреты хранить в локальном файле среды (env) — этого достаточно и безопасно на локальной машине. При деплое (например, Vercel или другой хостинг/функции) секреты хранить в переменных окружения на стороне хостинга.

Q13. Какие логи/отчётность вам нужны?
A13. Нужен лог самой программы для ошибок. Дополнительно — логи взаимодействий с Notion, Amazon SES и Supabase (ошибки API, количество ретраев и т.п.).

Q14. Какой технологический стек предпочтителен?
A14. Сильных предпочтений нет, но в перспективе планируется веб‑интерфейс, поэтому предпочтительны React + Node.js. Если предлагается другой стек, нужна понятная выгода.

Q15. Где планируется размещать сервис и как выглядит деплой?
A15. Сначала локальная отладка, затем деплой на Vercel через GitHub.

Q16. Какие интеграции, кроме Notion, Supabase и Amazon SES/SNS, нужны сейчас или в ближайшем будущем?
A16. Пока только Notion, Supabase и Amazon SES/SNS.

Q17. Нужен ли веб‑интерфейс уже сейчас, или пока только API/вебхук?
A17. Пока всё через Notion. Планируются две таблицы в Notion: «письма» и «настройки» (если понадобится). Если Notion не удовлетворит, позже сделать веб‑интерфейс.

Q18. Как управлять настройками рассылки (лимиты скорости, sender, тестовый режим)?
A18. Через env‑файл (проще, чем через Notion).

Q19. Нужен ли тестовый режим и как его включать?
A19. Да, нужен. В Notion для письма ставится чекбокс «тест»; если он включён, отправка идёт только по списку тестовых адресов из env‑файла.

Q20. Нужны ли дополнительные артефакты/экспорт кроме отчёта в Notion?
A20. Пока нет.

Q21. Как получать сообщения об ошибках или проблемах?
A21. Нужна таблица ошибок в Notion (для агрегации/экспорта). Дополнительно для каждой рассылки — CSV‑файл с ошибками, чтобы удобно анализировать ИИ.

Q22. Нужны ли ограничения по производительности (скорость, объём, время)?
A22. Да: лимит SES около 14 писем/сек, но лучше ограничить 5–6 писем/сек. Лимит должен настраиваться через env‑файл; начинать с малого.

Q23. Какие требования к безопасности/доступу?
A23. Сервис не публичный; доступ только у одного администратора (пользователя). Предположительно доступ по e‑mail/паролю, больше никто запускать рассылку не должен.

Q24. Нужны ли юридические/комплаенс‑требования (GDPR/152‑ФЗ и т.п.)?
A24. Адреса будут импортироваться из GetResponse (экспорт с обязательными полями/согласиями). План — хранить в Supabase все поля, которые есть в файле экспорта; отдельные требования пока не сформулированы.

Q25. Какие поля в экспорте GetResponse (или будет пример файла)?
A25. Получен пример Waite.csv. Заголовки (60 колонок): id, campaign, name, email, sign_up, optin, origin, score, engagement_score, geo:ip, geo:latitude, geo:longitude, geo:country, geo:region, geo:city, geo:continent_code, geo:country_code, geo:region_code, geo:postal_code, geo:dma_code, geo:time_zone, tag:145943, tag:145944, tag:145945, tag:1_1period, tag:2_1period, tag:3_2period, tag:aiagent, tag:ainews, tag:chatgpt, tag:clean, tag:end_chatgpt, tag:expired, tag:get_in_chatgpt, tag:getinaiagents, tag:qwerty, tag:zapier, custom:birthdate, custom:city, custom:comment, custom:company, custom:country, custom:fax, custom:gateway, custom:gender, custom:github, custom:home_phone, custom:http_referer, custom:membership, custom:mobile_phone, custom:phone, custom:postal_code, custom:product_name, custom:projecturl, custom:ref, custom:state, custom:street, custom:url, custom:work_phone, last_update.

Q26. Как загружать CSV в Supabase?
A26. Проще всего через импорт: создать таблицу на основе существующего CSV (возможность импорта в Supabase).

Q27. Нужно ли вести историю рассылок (лог отправок по каждому адресу)?
A27. Достаточно таблицы писем в Notion с репортом после каждой отправки — это и есть история рассылок. Дополнительный лог по каждому адресу сейчас не нужен.

Q28. Что должно происходить при повторной попытке отправки того же письма?
A28. Если статус письма уже «отправлено», повторный запуск не должен отправлять письмо снова; желательно сообщать об ошибке, но достаточно защиты через статус в Notion. Метрики открытий/кликов пока не учитывать (отложить).

Q29. Требования по хранению данных (сроки хранения, удаление по запросу)?
A29. Пока требований нет.

Q30. Какие типы ошибок критичны (останавливают рассылку), а какие можно игнорировать?
A30. Критично: проблемы связи с Amazon SES или Supabase — нужно остановить и разбираться. Также критично, если SES возвращает ошибку/не подтверждает отправку. Других критичных сценариев пока не определено (можно предложить дополнительно).

Q31. Нужны ли требования к тестам/качеству?
A31. Да, нужно автоматизированное тестирование, прежде всего логики ошибок, чтобы убедиться, что всё работает на нашей стороне.

Q32. Нужны ли сценарии повторных попыток (retry) при временных ошибках?
A32. Пока неясно; это зависит от протокола SES/SNS и точек возможного сбоя. Возможные временные ошибки — доступ к Supabase. Нужны предложения по ретраям.

Q33. Какой подход к ретраям выбрать на старте?
A33. Базовый: ретраи только на сетевые/5xx ошибки Supabase и временные ошибки SES, с ограниченным числом попыток и экспоненциальной паузой.

Q34. Нужны ли требования к наблюдаемости (метрики/алерты)?
A34. На старте достаточно логов и таблиц в Notion; метрики/алерты не нужны.

Q35. Нужны ли миграции/резервное копирование/катастрофоустойчивость?
A35. Пока нет необходимости.

Q36. Есть ли требования к локализации/языкам писем?
A36. Изначально письма на русском языке; английский — по умолчанию. Возможны вопросы кодировок.

Q37. Требования к формату письма (HTML/текст/Multipart)?
A37. Желательно иметь plain‑text версию. Формат входа из Notion пока неясен: возможно Markdown, который надо конвертировать; требуется исследовать цепочку (что можно верстать в Notion и как выглядит письмо).

Q38. Нужен ли режим предпросмотра письма перед отправкой?
A38. Режим предпросмотра = тестовый режим: письмо с чекбоксом «тест» можно отправлять повторно на список тестовых адресов, чтобы проверить вид письма.

Q39. Требования к unsubscribe‑ссылке и механизму отписки?
A39. Базовый вариант принят: ссылка вида https://<домен>/unsubscribe?token=..., публичная страница подтверждения; по токену помечаем e‑mail как unsubscribed в Supabase. URL берём из env.

Q40. Нужны ли ограничения на размер базы/письма?
A40. Ориентируемся на лимиты Amazon SES (около 50k писем/день), это существенно больше текущих потребностей.

Q41. Нужно ли обновлять статусы bounce/complaint из SNS в реальном времени?
A41. Реального времени не требуется; можно обрабатывать события по мере их поступления без спешки.

Q42. Нужна ли защита от повторной обработки SNS‑событий (дедупликация)?
A42. Повторная отправка писем предотвращается статусом «отправлено» (кроме тестового режима). Вопрос про дедупликацию SNS ещё не прояснён; алерты/место фиксации событий нужно определить.

Q43. Как обрабатывать возможные дубликаты SNS‑событий (bounce/complaint)?
A43. На старте — простой идемпотентный подход без явной дедупликации: повторно ставим тот же статус, это допустимо.

Q44. Какой формат данных должен содержать webhook/Notion‑запись для запуска рассылки?
A44. Пока неизвестно; нужно уточнить по открытой документации (TODO).

Q45. Нужны ли вложения в письмах?
A45. Вложений не будет. Письма — простой формат: текст, изображения, ссылки. Нужно ещё понять, как загружать/подключать картинки (источник/URL).

Q46. Нужно ли хранить версии письма?
A46. Нет, версии хранятся в Notion.

Q47. Нужны ли валидации перед отправкой (тема/не пустое письмо/unsubscribe‑ссылка)?
A47. Да, можно добавить базовые проверки; это несложно.

Q48. Как обрабатывать некорректные e‑mail в базе?
A48. Ожидается, что база чистая (экспорт из GetResponse). Если вдруг формат некорректный, SES сам не пропустит. Дополнительной обработки не требуется.

Q49. Нужно ли сохранять исходный HTML/Markdown письма в Supabase?
A49. На старте — нет, достаточно ссылаться на Notion.

Q50. Нужен ли механизм повторной отправки (re-send) для части базы?
A50. Пока нет: нет понимания механизма «не получил», а доставляемость SES высокая (~99%), поэтому re-send не требуется.

Q51. Какие минимальные поля нужны в таблице «Письма» в Notion?
A51. Поле «тело письма» (включает тему и body). Дополнительно: статус, тестовый чекбокс, дата отправки и стандартные поля.

Q52. Какие статусы для письма должны быть в Notion и кто их выставляет?
A52. Только Send и Failed; статусы выставляет утилита на основании ответа Amazon SES.

Q53. Как инициировать отправку из Notion?
A53. Через кнопку в Notion: нажал кнопку — запуск отправки.

Q54. Нужен ли идентификатор рассылки/письма (mailout_id) и где хранить?
A54. Да, пусть будет. Можно использовать ID записи Notion как mailout_id.

Q55. Как хранить список тестовых адресов?
A55. В env как несколько строк (без запятых).

Q56. Нужно ли ограничивать число тестовых отправок?
A56. Нет, тестовый режим свободный.

Q57. Нужны ли дополнительные уведомления после рассылки (например, письмо вам)?
A57. На старте — нет, достаточно обновлений в Notion.

Q58. Требования к теме письма и контенту?
A58. Тема и текст полностью из Notion. Автоматически добавлять стандартный подвал (адрес, ссылка на отписку и т.п.) из env.

Q59. Имя отправителя (From Name) и Reply‑To — где задавать?
A59. Имя отправителя берётся из Supabase; Reply‑To задаётся в env‑файле.

Q60. Где задавать адрес From (e‑mail отправителя)?
A60. В env‑файле.

Q61. Нужно ли маскировать/шифровать данные в логах (например, e‑mail)?
A61. Нет, шифрование/маскировка не требуется.

Q62. Нужен ли лимит на число одновременных рассылок?
A62. Нет.

Q63. Нужна ли отдельная таблица ошибок в Notion и CSV?
A63. Да, отдельная таблица ошибок в Notion + отдельный CSV для выгрузки.

Q64. Какие поля должны быть в таблице ошибок?
A64. Подтверждён минимальный набор: timestamp, mailout_id/ID записи Notion, is_test, provider (Notion/Supabase/SES/SNS), stage (fetch content/build message/send/report), email (если применимо), error_code/HTTP status, error_message, retry_count. При необходимости добавим позже.

Q65. Нужна ли отдельная таблица/список отписок в Notion?
A65. Нет, достаточно статусов в Supabase; в Notion нужно лишь видеть эти статусы.

Q66. Нужна ли история изменений статуса подписчика (когда и почему он стал bounced/unsubscribed)?
A66. Нет, история изменений не нужна.

Q67. Где хранить/отображать статус подписчиков в Notion?
A67. В Notion статусы подписчиков не храним; всё хранится в Supabase. В Notion только таблица писем.

Q68. Нужно ли хранить агрегированные метрики по рассылкам в Supabase?
A68. Нет, хранить агрегированные метрики не нужно.

Q69. Нужна ли отдельная таблица настроек в Notion?
A69. Нет, все настройки уже в env.

Q70. Ограничивать размер письма/изображений или оставить лимиты SES по умолчанию?
A70. Оставить по умолчанию (лимиты SES).

Q71. Нужен ли механизм ручного отключения рассылок (kill‑switch)?
A71. Нет, сервис не автоматический; утилита запускается разово по кнопке.

Q72. Нужен ли dry‑run режим (без реальной отправки)?
A72. Нет, достаточно тестового режима.

Q73. Требования к лицензированию/ограничениям использования?
A73. Нет, это частное использование, не публичный сервис.
